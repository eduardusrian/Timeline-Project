<!doctype html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Timeline &amp; MoM System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    * { box-sizing: border-box; }
    .nav-item { transition: all 0.3s ease; }
    .nav-item:hover { transform: translateX(4px); }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
    .status-pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
    .timeline-line { background: linear-gradient(180deg, #3b82f6 0%, #8b5cf6 100%); }
    .fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .glass-effect { backdrop-filter: blur(10px); }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
    .dark ::-webkit-scrollbar-thumb { background: #475569; }
  </style>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: { 50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e' },
            accent: { 500: '#8b5cf6', 600: '#7c3aed' }
          }
        }
      }
    }
  </script>
</head>
<body class="h-full bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 transition-colors duration-300">
  <div id="app" class="h-full flex flex-col lg:flex-row overflow-auto">
    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="w-full lg:w-64 bg-white dark:bg-slate-800 shadow-xl lg:shadow-none border-b lg:border-b-0 lg:border-r border-slate-200 dark:border-slate-700 flex-shrink-0">
      <div class="p-4 lg:p-6">
        <div class="flex items-center justify-between lg:justify-start gap-3 mb-6">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path>
              </svg>
            </div>
            <h1 id="app-title" class="text-lg font-bold bg-gradient-to-r from-primary-600 to-accent-600 bg-clip-text text-transparent">Timeline System</h1>
          </div>
          <button id="mobile-menu-btn" class="lg:hidden p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
        </div>
        <div id="nav-menu" class="hidden lg:block space-y-2">
          <button onclick="showPage('dashboard')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left font-medium transition-all" data-page="dashboard">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path>
            </svg> Dashboard
          </button>
          <button onclick="showPage('update')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left font-medium transition-all" data-page="update">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg> Update Project
          </button>
          <button onclick="showPage('management')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left font-medium transition-all" data-page="management">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg> Project Management
          </button>
          <button onclick="showPage('history')" class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left font-medium transition-all" data-page="history">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg> History
          </button>
        </div>
        <div id="nav-menu-footer" class="hidden lg:block mt-8 pt-6 border-t border-slate-200 dark:border-slate-700">
          <button id="theme-toggle" onclick="toggleTheme()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl text-left font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition-all">
            <svg id="theme-icon-light" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg id="theme-icon-dark" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
            <span class="dark:hidden">Dark Mode</span>
            <span class="hidden dark:inline">Light Mode</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 overflow-auto">
      <!-- Dashboard Page -->
      <div id="page-dashboard" class="page p-4 lg:p-8 fade-in">
        <div class="max-w-7xl mx-auto">
          <!-- Header with Date/Time -->
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
            <div>
              <h2 id="dashboard-title" class="text-2xl lg:text-3xl font-bold text-slate-800 dark:text-white">Project Dashboard</h2>
              <p class="text-slate-500 dark:text-slate-400 mt-1">Monitor semua project dalam satu tampilan</p>
            </div>
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
              <div class="bg-white dark:bg-slate-800 rounded-2xl px-5 py-3 shadow-lg border border-slate-200 dark:border-slate-700">
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-primary-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  <div>
                    <p id="current-date" class="text-sm font-semibold text-slate-800 dark:text-white"></p>
                    <p id="current-time" class="text-xs text-slate-500 dark:text-slate-400"></p>
                  </div>
                </div>
              </div>
              <div class="bg-white dark:bg-slate-800 rounded-2xl px-5 py-3 shadow-lg border border-slate-200 dark:border-slate-700">
                <div class="flex items-center gap-3">
                  <svg id="network-icon" class="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path>
                  </svg>
                  <div>
                    <p id="network-speed" class="text-sm font-semibold text-slate-800 dark:text-white">Mengecek...</p>
                    <p id="network-status" class="text-xs text-slate-500 dark:text-slate-400">Connection</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl p-5 text-white card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-primary-100 text-sm">Total Project</p>
                  <p id="stat-total" class="text-3xl font-bold mt-1">0</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                  </svg>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-5 text-white card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-emerald-100 text-sm">Open</p>
                  <p id="stat-open" class="text-3xl font-bold mt-1">0</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-slate-500 to-slate-600 rounded-2xl p-5 text-white card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-slate-200 text-sm">Closed</p>
                  <p id="stat-closed" class="text-3xl font-bold mt-1">0</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-rose-500 to-rose-600 rounded-2xl p-5 text-white card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-rose-100 text-sm">Due Soon</p>
                  <p id="stat-due" class="text-3xl font-bold mt-1">0</p>
                </div>
                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center status-pulse">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Open Projects -->
          <div class="mb-8">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-3 h-3 bg-emerald-500 rounded-full status-pulse"></div>
              <h3 class="text-xl font-bold text-slate-800 dark:text-white">Project Open</h3>
            </div>
            <div id="open-projects" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
              <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 text-center">
                <p class="text-slate-400">Tidak ada project open</p>
              </div>
            </div>
          </div>

          <!-- Project Detail Modal -->
          <div id="project-detail-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-6xl my-8">
              <div class="p-6 border-b border-slate-200 dark:border-slate-700">
                <div class="flex items-center justify-between">
                  <div>
                    <h3 id="detail-project-name" class="text-2xl font-bold text-slate-800 dark:text-white mb-1"></h3>
                    <p id="detail-project-info" class="text-slate-500 dark:text-slate-400"></p>
                  </div>
                  <button onclick="closeProjectDetail()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition-all">
                    <svg class="w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
              </div>
              <div class="p-6 max-h-[70vh] overflow-y-auto">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <!-- Visual Timeline -->
                  <div>
                    <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-4 flex items-center gap-2">
                      <svg class="w-5 h-5 text-primary-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                      </svg> Timeline Progress
                    </h4>
                    <div id="detail-timeline" class="space-y-4"></div>
                  </div>

                  <!-- MoM Section -->
                  <div>
                    <div class="flex items-center justify-between mb-4">
                      <h4 class="text-lg font-semibold text-slate-800 dark:text-white flex items-center gap-2">
                        <svg class="w-5 h-5 text-accent-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg> Minutes of Meeting
                      </h4>
                      <button onclick="showAddMoMForm()" class="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white text-sm font-semibold rounded-lg transition-all">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg> Add MoM
                      </button>
                    </div>

                    <!-- Add MoM Form -->
                    <div id="add-mom-form" class="hidden bg-slate-50 dark:bg-slate-700/50 rounded-xl p-4 mb-4">
                      <h5 class="font-semibold text-slate-800 dark:text-white mb-3">Add New MoM</h5>
                      <div class="space-y-3">
                        <div>
                          <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300 mb-1">Tanggal Meeting</label>
                          <input type="date" id="mom-date" class="w-full px-3 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        </div>
                        <div>
                          <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300 mb-1">Attendees (pisahkan dengan koma)</label>
                          <input type="text" id="mom-attendees" placeholder="John Doe, Jane Smith" class="w-full px-3 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                        </div>
                        <div>
                          <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300 mb-1">Discussion Summary</label>
                          <textarea id="mom-discussion" rows="3" placeholder="Ringkasan diskusi..." class="w-full px-3 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"></textarea>
                        </div>
                        <div>
                          <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300 mb-1">Action Items (pisahkan dengan enter)</label>
                          <textarea id="mom-actions" rows="3" placeholder="- Action item 1
- Action item 2" class="w-full px-3 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"></textarea>
                        </div>
                        <div>
                          <label class="block text-xs font-semibold text-slate-700 dark:text-slate-300 mb-2">Foto Meeting (Opsional)</label>
                          <div class="flex gap-2 mb-2">
                            <label class="flex-1 cursor-pointer">
                              <div class="flex items-center justify-center gap-2 px-3 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg hover:border-primary-500 dark:hover:border-primary-400 transition-all bg-white dark:bg-slate-700">
                                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <span class="text-xs text-slate-600 dark:text-slate-400">ðŸ“± Upload dari Galeri</span>
                              </div>
                              <input type="file" id="mom-photo-gallery" accept="image/*" class="hidden" onchange="handlePhotoUpload(event, 'preview')">
                            </label>
                            <button type="button" onclick="openCamera('preview')" class="flex-1">
                              <div class="flex items-center justify-center gap-2 px-3 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg hover:border-primary-500 dark:hover:border-primary-400 transition-all bg-white dark:bg-slate-700">
                                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span class="text-xs text-slate-600 dark:text-slate-400">ðŸ“· Ambil Foto</span>
                              </div>
                            </button>
                          </div>
                          <div id="photo-preview-container" class="hidden relative mt-2">
                            <img loading="lazy" id="photo-preview" src="" alt="Preview foto meeting" class="w-full h-32 object-cover rounded-lg border-2 border-primary-300">
                            <button type="button" onclick="removePhoto('preview')" class="absolute top-2 right-2 p-1.5 bg-rose-500 hover:bg-rose-600 text-white rounded-full shadow-lg transition-all">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                              </svg>
                            </button>
                          </div>
                        </div>
                        <div class="flex gap-2">
                          <button onclick="hideAddMoMForm()" class="flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all">Batal</button>
                          <button onclick="submitMoM()" id="submit-mom-btn" class="flex-1 bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white font-semibold py-2 px-4 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            <span id="submit-mom-text">Simpan</span>
                            <span id="submit-mom-loading" class="hidden">Menyimpan...</span>
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- MoM List -->
                    <div id="mom-list" class="space-y-3 max-h-96 overflow-y-auto">
                      <p class="text-slate-400 text-center py-4 text-sm">Belum ada MoM</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Edit MoM Modal -->
          <div id="edit-mom-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl">
              <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                  <h3 class="text-xl font-bold text-slate-800 dark:text-white">Edit MoM</h3>
                  <button onclick="closeEditMoMModal()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition-all">
                    <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
                <div class="space-y-4">
                  <input type="hidden" id="edit-mom-id">
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Tanggal Meeting</label>
                    <input type="date" id="edit-mom-date" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Attendees</label>
                    <input type="text" id="edit-mom-attendees" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Discussion Summary</label>
                    <textarea id="edit-mom-discussion" rows="3" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"></textarea>
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Action Items</label>
                    <textarea id="edit-mom-actions" rows="3" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"></textarea>
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Foto Meeting</label>
                    <div class="flex gap-2 mb-2">
                      <label class="flex-1 cursor-pointer">
                        <div class="flex items-center justify-center gap-2 px-3 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg hover:border-primary-500 dark:hover:border-primary-400 transition-all bg-white dark:bg-slate-700">
                          <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                          </svg>
                          <span class="text-xs text-slate-600 dark:text-slate-400">Upload Galeri</span>
                        </div>
                        <input type="file" id="edit-mom-photo-gallery" accept="image/*" class="hidden" onchange="handlePhotoUpload(event, 'edit')">
                      </label>
                      <button type="button" onclick="openCamera('edit')" class="flex-1">
                        <div class="flex items-center justify-center gap-2 px-3 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg hover:border-primary-500 dark:hover:border-primary-400 transition-all bg-white dark:bg-slate-700">
                          <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                          </svg>
                          <span class="text-xs text-slate-600 dark:text-slate-400">Ambil Foto</span>
                        </div>
                      </button>
                    </div>
                    <div id="edit-photo-preview-container" class="hidden relative mt-2">
                      <img loading="lazy" id="edit-photo-preview" src="" alt="Preview foto meeting" class="w-full h-40 object-cover rounded-lg border-2 border-primary-300">
                      <button onclick="removePhoto('edit')" class="absolute top-2 right-2 p-1.5 bg-rose-500 hover:bg-rose-600 text-white rounded-full shadow-lg transition-all">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="flex gap-3 pt-4">
                    <button onclick="closeEditMoMModal()" class="flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all">Batal</button>
                    <button onclick="saveEditMoM()" id="save-edit-mom-btn" class="flex-1 bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white font-semibold py-3 px-6 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                      <span id="save-edit-mom-text">Simpan</span>
                      <span id="save-edit-mom-loading" class="hidden">Menyimpan...</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Closed Projects -->
          <div>
            <div class="flex items-center gap-3 mb-4">
              <div class="w-3 h-3 bg-slate-400 rounded-full"></div>
              <h3 class="text-xl font-bold text-slate-800 dark:text-white">Project Closed</h3>
            </div>
            <div id="closed-projects" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
              <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 text-center">
                <p class="text-slate-400">Tidak ada project closed</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Update Project Page -->
      <div id="page-update" class="page hidden p-4 lg:p-8 fade-in">
        <div class="max-w-4xl mx-auto">
          <div class="mb-8">
            <h2 class="text-2xl lg:text-3xl font-bold text-slate-800 dark:text-white">Update Project</h2>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Perbarui progress dan step project</p>
          </div>
          <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 p-6 lg:p-8">
            <div class="space-y-6">
              <!-- Select Project -->
              <div>
                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Pilih Project</label>
                <select id="update-project-select" onchange="loadProjectForUpdate()" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                  <option value="">-- Pilih Project --</option>
                </select>
              </div>

              <!-- Project Info -->
              <div id="update-project-info" class="hidden">
                <div class="bg-slate-50 dark:bg-slate-700/50 rounded-xl p-5 mb-6">
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                      <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider">Nama Project</p>
                      <p id="update-info-name" class="font-semibold text-slate-800 dark:text-white mt-1"></p>
                    </div>
                    <div>
                      <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider">PIC</p>
                      <p id="update-info-pic" class="font-semibold text-slate-800 dark:text-white mt-1"></p>
                    </div>
                    <div>
                      <p class="text-xs text-slate-500 dark:text-slate-400 uppercase tracking-wider">Due Date</p>
                      <p id="update-info-due" class="font-semibold text-slate-800 dark:text-white mt-1"></p>
                    </div>
                  </div>
                </div>

                <!-- Timeline -->
                <div class="mb-6">
                  <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-4">Timeline Progress</h4>
                  <div id="update-timeline" class="space-y-4"></div>
                </div>

                <!-- Update Step Details -->
                <div class="mb-6">
                  <h4 class="text-lg font-semibold text-slate-800 dark:text-white mb-4">Update Progress per Step</h4>
                  <div id="step-updates-container" class="space-y-3"></div>
                </div>

                <!-- Update Step -->
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Update Step ke:</label>
                    <select id="update-step-select" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"></select>
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Status Project</label>
                    <select id="update-status-select" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                      <option value="open">Open</option>
                      <option value="closed">Closed</option>
                    </select>
                  </div>
                  <button onclick="updateProject()" id="update-btn" class="w-full bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white font-semibold py-3 px-6 rounded-xl transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                    <span id="update-btn-text">Update Project</span>
                    <span id="update-btn-loading" class="hidden">
                      <svg class="animate-spin inline w-5 h-5 mr-2" fill="none" viewbox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg> Updating...
                    </span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Project Management Page -->
      <div id="page-management" class="page hidden p-4 lg:p-8 fade-in">
        <div class="max-w-6xl mx-auto">
          <!-- Login Gate -->
          <div id="management-login" class="max-w-md mx-auto">
            <div class="text-center mb-8">
              <div class="w-20 h-20 bg-gradient-to-br from-primary-500 to-accent-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-slate-800 dark:text-white">Project Management</h2>
              <p class="text-slate-500 dark:text-slate-400 mt-2">Masukkan password untuk mengakses</p>
            </div>
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 p-6">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Password</label>
                  <input type="password" id="management-password" placeholder="Masukkan password" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                  <p id="login-error" class="hidden text-red-500 text-sm mt-2">Password salah!</p>
                </div>
                <button onclick="loginManagement()" class="w-full bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white font-semibold py-3 px-6 rounded-xl transition-all transform hover:scale-[1.02]"> Login </button>
              </div>
            </div>
          </div>

          <!-- Management Content -->
          <div id="management-content" class="hidden">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
              <div>
                <h2 class="text-2xl lg:text-3xl font-bold text-slate-800 dark:text-white">Project Management</h2>
                <p class="text-slate-500 dark:text-slate-400 mt-1">Tambah dan kelola project</p>
              </div>
              <button onclick="logoutManagement()" class="flex items-center gap-2 px-4 py-2 rounded-xl bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 font-medium transition-all">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg> Logout
              </button>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
              <!-- Add Project Form -->
              <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 p-6">
                <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-6">Tambah Project Baru</h3>
                <div class="space-y-4">
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Nama Project</label>
                    <input type="text" id="project-name" placeholder="Masukkan nama project" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">PIC (Person in Charge)</label>
                    <input type="text" id="project-pic" placeholder="Nama PIC" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Estimasi Tanggal Pelaksanaan</label>
                    <input type="date" id="project-due" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                  </div>
                  <div>
                    <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Steps Project</label>
                    <div id="steps-container" class="space-y-2 mb-3">
                      <div class="flex gap-2">
                        <input type="text" class="step-input flex-1 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="Step 1">
                      </div>
                    </div>
                    <button onclick="addStep()" class="flex items-center gap-2 text-primary-500 hover:text-primary-600 font-medium text-sm">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                      </svg> Add Step
                    </button>
                  </div>
                  <button onclick="submitProject()" id="submit-project-btn" class="w-full bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white font-semibold py-3 px-6 rounded-xl transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                    <span id="submit-btn-text">Submit Project</span>
                    <span id="submit-btn-loading" class="hidden">
                      <svg class="animate-spin inline w-5 h-5 mr-2" fill="none" viewbox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg> Menyimpan...
                    </span>
                  </button>
                </div>
              </div>

              <!-- Project List -->
              <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 p-6">
                <h3 class="text-lg font-bold text-slate-800 dark:text-white mb-6">Daftar Project</h3>
                <div id="project-list" class="space-y-3 max-h-96 overflow-y-auto">
                  <p class="text-slate-400 text-center py-4">Tidak ada project</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- History Page -->
      <div id="page-history" class="page hidden p-4 lg:p-8 fade-in">
        <div class="max-w-5xl mx-auto">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
            <div>
              <h2 class="text-2xl lg:text-3xl font-bold text-slate-800 dark:text-white">History</h2>
              <p class="text-slate-500 dark:text-slate-400 mt-1">Riwayat semua kegiatan sistem</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-3">
              <select id="pdf-project-select" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
                <option value="">-- Pilih Project untuk PDF --</option>
              </select>
              <button onclick="downloadPDF()" class="flex items-center justify-center gap-2 px-5 py-2 bg-gradient-to-r from-rose-500 to-rose-600 hover:from-rose-600 hover:to-rose-700 text-white font-semibold rounded-xl transition-all transform hover:scale-[1.02]">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg> Download PDF
              </button>
            </div>
          </div>
          <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-slate-200 dark:border-slate-700 overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="bg-slate-50 dark:bg-slate-700/50">
                  <tr>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Waktu</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Aksi</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Detail</th>
                  </tr>
                </thead>
                <tbody id="history-table" class="divide-y divide-slate-200 dark:divide-slate-700">
                  <tr>
                    <td colspan="3" class="px-6 py-8 text-center text-slate-400">Tidak ada riwayat</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Modal -->
      <div id="edit-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90%] overflow-y-auto">
          <div class="p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-bold text-slate-800 dark:text-white">Edit Project</h3>
              <button onclick="closeEditModal()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition-all">
                <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div class="space-y-4">
              <input type="hidden" id="edit-project-id">
              <div>
                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Nama Project</label>
                <input type="text" id="edit-project-name" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">PIC</label>
                <input type="text" id="edit-project-pic" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Due Date</label>
                <input type="date" id="edit-project-due" class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
              </div>
              <div>
                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Steps Project</label>
                <div id="edit-steps-container" class="space-y-2 mb-3"></div>
                <button onclick="addEditStep()" class="flex items-center gap-2 text-primary-500 hover:text-primary-600 font-medium text-sm">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                  </svg> Add Step
                </button>
              </div>
              <div class="flex gap-3 pt-4">
                <button onclick="closeEditModal()" class="flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all">Batal</button>
                <button onclick="saveEditProject()" id="save-edit-btn" class="flex-1 bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white font-semibold py-3 px-6 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                  <span id="save-edit-btn-text">Simpan</span>
                  <span id="save-edit-btn-loading" class="hidden">Menyimpan...</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Delete Confirmation Modal -->
      <div id="delete-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-md p-6">
          <div class="text-center">
            <div class="w-16 h-16 bg-rose-100 dark:bg-rose-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-rose-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-slate-800 dark:text-white mb-2">Hapus Project?</h3>
            <p id="delete-project-name" class="text-slate-500 dark:text-slate-400 mb-6"></p>
            <input type="hidden" id="delete-project-id">
            <div class="flex gap-3">
              <button onclick="closeDeleteModal()" class="flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all">Batal</button>
              <button onclick="confirmDelete()" id="confirm-delete-btn" class="flex-1 bg-rose-500 hover:bg-rose-600 text-white font-semibold py-3 px-6 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                <span id="confirm-delete-btn-text">Hapus</span>
                <span id="confirm-delete-btn-loading" class="hidden">Menghapus...</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Camera Modal -->
      <div id="camera-modal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl">
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-xl font-bold text-slate-800 dark:text-white">ðŸ“· Ambil Foto</h3>
              <button onclick="closeCameraModal()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition-all">
                <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            <div class="relative bg-black rounded-xl overflow-hidden" style="aspect-ratio: 4/3;">
              <video id="camera-video" class="w-full h-full object-cover" autoplay playsinline></video>
              <canvas id="camera-canvas" class="hidden"></canvas>
            </div>
            <div class="flex gap-3 mt-4">
              <button onclick="closeCameraModal()" class="flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-all">Batal</button>
              <button onclick="capturePhoto()" class="flex-1 bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white font-semibold py-3 px-6 rounded-xl transition-all flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg> Ambil Foto
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Toast Notification -->
      <div id="toast" class="hidden fixed bottom-4 right-4 z-50 bg-slate-800 dark:bg-slate-700 text-white px-6 py-4 rounded-xl shadow-lg flex items-center gap-3 fade-in">
        <svg id="toast-icon-success" class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <svg id="toast-icon-error" class="hidden w-5 h-5 text-rose-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span id="toast-message"></span>
      </div>
    </main>
  </div>

  <script>
    // ============================================
    // STATE MANAGEMENT (Menggunakan localStorage sebagai fallback)
    // ============================================
    let projects = JSON.parse(localStorage.getItem('timeline_projects') || '[]');
    let history = JSON.parse(localStorage.getItem('timeline_history') || '[]');
    let moms = JSON.parse(localStorage.getItem('timeline_moms') || '[]');
    let currentPage = 'dashboard';
    let isLoggedIn = localStorage.getItem('timeline_logged_in') === 'true';
    let selectedProjectForUpdate = null;
    let projectToDelete = null;
    let selectedProjectDetail = null;
    let momToEdit = null;
    let uploadedPhotoData = {
      preview: null,
      edit: null
    };
    let cameraStream = null;
    let currentCameraType = null;

    // Helper function untuk save data ke localStorage
    function saveProjects() {
      localStorage.setItem('timeline_projects', JSON.stringify(projects));
    }

    function saveHistory() {
      localStorage.setItem('timeline_history', JSON.stringify(history));
    }

    function saveMoms() {
      localStorage.setItem('timeline_moms', JSON.stringify(moms));
    }

    // ============================================
    // DATE/TIME FUNCTIONS
    // ============================================

    function updateDateTime() {
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const dateEl = document.getElementById('current-date');
      const timeEl = document.getElementById('current-time');
      
      if (dateEl) dateEl.textContent = now.toLocaleDateString('id-ID', options);
      if (timeEl) timeEl.textContent = now.toLocaleTimeString('id-ID');
    }

    // ============================================
    // INITIALIZE APP
    // ============================================

    function initApp() {
      updateDateTime();
      setInterval(updateDateTime, 1000);

      checkNetworkSpeed();
      setInterval(checkNetworkSpeed, 30000);

      document.getElementById('mobile-menu-btn').addEventListener('click', () => {
        const menu = document.getElementById('nav-menu');
        menu.classList.toggle('hidden');
      });

      if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }

      fetchAllData();
      showPage('dashboard');
    }

    // ============================================
    // THEME TOGGLE
    // ============================================

    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
    }

    // ============================================
    // NAVIGATION
    // ============================================

    function showPage(page) {
      if (currentPage === 'management' && page !== 'management' && isLoggedIn) {
        logoutManagement();
      }

      currentPage = page;
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      const pageElement = document.getElementById(`page-${page}`);
      if (pageElement) pageElement.classList.remove('hidden');
      
      document.querySelectorAll('[data-page]').forEach(btn => {
        btn.classList.remove('bg-primary-100', 'dark:bg-primary-900/30', 'text-primary-600', 'dark:text-primary-400');
        btn.classList.add('text-slate-600', 'dark:text-slate-400', 'hover:bg-slate-100', 'dark:hover:bg-slate-700');
      });
      
      const activeBtn = document.querySelector(`[data-page="${page}"]`);
      if (activeBtn) {
        activeBtn.classList.add('bg-primary-100', 'dark:bg-primary-900/30', 'text-primary-600', 'dark:text-primary-400');
        activeBtn.classList.remove('text-slate-600', 'dark:text-slate-400', 'hover:bg-slate-100', 'dark:hover:bg-slate-700');
      }

      if (window.innerWidth < 1024) {
        const navMenu = document.getElementById('nav-menu');
        if (navMenu) navMenu.classList.add('hidden');
      }

      // Refresh data ketika pindah halaman
      if (page === 'dashboard' || page === 'update' || page === 'management' || page === 'history') {
        fetchAllData();
      }
    }

    // ============================================
    // NETWORK SPEED MONITORING
    // ============================================

    async function checkNetworkSpeed() {
      const speedEl = document.getElementById('network-speed');
      const statusEl = document.getElementById('network-status');
      const iconEl = document.getElementById('network-icon');

      if (!speedEl || !statusEl || !iconEl) return;

      if (!navigator.onLine) {
        speedEl.textContent = 'Offline';
        statusEl.textContent = 'No Connection';
        iconEl.className = 'w-5 h-5 text-rose-500';
        return;
      }

      try {
        if (navigator.connection && navigator.connection.downlink) {
          const speedMbps = navigator.connection.downlink;
          const effectiveType = navigator.connection.effectiveType;

          let speedText = '';
          let statusText = '';
          let colorClass = '';

          if (speedMbps >= 5 || effectiveType === '4g') {
            speedText = `${speedMbps.toFixed(1)} Mbps`;
            statusText = 'Excellent';
            colorClass = 'text-emerald-500';
          } else if (speedMbps >= 2 || effectiveType === '3g') {
            speedText = `${speedMbps.toFixed(1)} Mbps`;
            statusText = 'Good';
            colorClass = 'text-blue-500';
          } else if (speedMbps >= 0.5 || effectiveType === '2g') {
            speedText = `${speedMbps.toFixed(2)} Mbps`;
            statusText = 'Fair';
            colorClass = 'text-amber-500';
          } else {
            speedText = `${speedMbps.toFixed(2)} Mbps`;
            statusText = 'Slow';
            colorClass = 'text-orange-500';
          }

          speedEl.textContent = speedText;
          statusEl.textContent = statusText;
          iconEl.className = `w-5 h-5 ${colorClass}`;
          return;
        }

        const startTime = performance.now();
        
        const response = await fetch('https://jsonplaceholder.typicode.com/users/1', { 
          method: 'GET',
          cache: 'no-cache'
        });
        
        if (!response.ok) throw new Error('Network error');
        
        await response.json();
        const endTime = performance.now();
        const latency = Math.round(endTime - startTime);

        let speedText = '';
        let statusText = '';
        let colorClass = '';

        if (latency < 100) {
          speedText = 'Sangat Cepat';
          statusText = 'Excellent';
          colorClass = 'text-emerald-500';
        } else if (latency < 300) {
          speedText = 'Cepat';
          statusText = 'Good';
          colorClass = 'text-blue-500';
        } else if (latency < 600) {
          speedText = 'Sedang';
          statusText = 'Fair';
          colorClass = 'text-amber-500';
        } else {
          speedText = 'Lambat';
          statusText = 'Slow';
          colorClass = 'text-orange-500';
        }

        speedEl.textContent = `${speedText} (${latency}ms)`;
        statusEl.textContent = statusText;
        iconEl.className = `w-5 h-5 ${colorClass}`;

      } catch (error) {
        speedEl.textContent = 'Terhubung';
        statusEl.textContent = 'Connected';
        iconEl.className = 'w-5 h-5 text-blue-500';
      }
    }

    window.addEventListener('online', () => {
      checkNetworkSpeed();
    });

    window.addEventListener('offline', () => {
      checkNetworkSpeed();
    });

    // ============================================
    // TOAST NOTIFICATION
    // ============================================

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const successIcon = document.getElementById('toast-icon-success');
      const errorIcon = document.getElementById('toast-icon-error');

      if (!toast || !toastMessage || !successIcon || !errorIcon) return;

      toastMessage.textContent = message;
      
      if (type === 'success') {
        successIcon.classList.remove('hidden');
        errorIcon.classList.add('hidden');
      } else {
        successIcon.classList.add('hidden');
        errorIcon.classList.remove('hidden');
      }

      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    // ============================================
    // DATA MANAGEMENT
    // ============================================

    function fetchAllData() {
      try {
        // Render everything
        renderDashboard();
        renderProjectList();
        renderUpdateProjectSelect();
        renderHistoryTable();
        renderPDFSelect();
        
        if (selectedProjectDetail) {
          renderMoMList(selectedProjectDetail.id);
        }

        console.log('âœ… Data loaded from localStorage');
      } catch (error) {
        console.error('âŒ Error loading data:', error);
        showToast('Gagal mengambil data: ' + error.message, 'error');
      }
    }

    // ============================================
    // CAMERA FUNCTIONS
    // ============================================

    async function openCamera(type) {
      currentCameraType = type;
      const modal = document.getElementById('camera-modal');
      const video = document.getElementById('camera-video');

      if (!modal || !video) return;

      modal.classList.remove('hidden');

      try {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          showToast('Browser tidak support akses kamera. Gunakan upload foto!', 'error');
          closeCameraModal();
          return;
        }

        try {
          cameraStream = await navigator.mediaDevices.getUserMedia({ 
            video: { 
              facingMode: { ideal: 'environment' },
              width: { ideal: 1280 },
              height: { ideal: 720 }
            } 
          });
        } catch (err) {
          cameraStream = await navigator.mediaDevices.getUserMedia({ 
            video: {
              width: { ideal: 1280 },
              height: { ideal: 720 }
            }
          });
        }

        video.srcObject = cameraStream;
        await video.play();
      } catch (error) {
        console.error('Camera error:', error);
        let errorMessage = 'Gagal mengakses kamera';
        
        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
          errorMessage = 'Izin kamera ditolak. Klik ikon kamera di address bar untuk mengizinkan, lalu coba lagi!';
        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
          errorMessage = 'Kamera tidak ditemukan. Gunakan upload foto dari galeri!';
        } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {
          errorMessage = 'Kamera sedang digunakan aplikasi lain. Tutup aplikasi lain lalu coba lagi!';
        } else if (error.message) {
          errorMessage = error.message;
        }

        showToast(errorMessage, 'error');
        closeCameraModal();
      }
    }

    function closeCameraModal() {
      const modal = document.getElementById('camera-modal');
      const video = document.getElementById('camera-video');

      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
        cameraStream = null;
      }

      if (video) video.srcObject = null;
      if (modal) modal.classList.add('hidden');
      currentCameraType = null;
    }

    function capturePhoto() {
      const video = document.getElementById('camera-video');
      const canvas = document.getElementById('camera-canvas');

      if (!video || !video.videoWidth || !video.videoHeight) {
        showToast('Video belum siap. Tunggu sebentar lalu coba lagi!', 'error');
        return;
      }

      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      const base64Data = canvas.toDataURL('image/jpeg', 0.85);

      const sizeInMB = (base64Data.length * 0.75) / (1024 * 1024);
      if (sizeInMB > 4) {
        showToast('Ukuran foto terlalu besar. Coba foto dengan jarak lebih jauh!', 'error');
        return;
      }

      uploadedPhotoData[currentCameraType] = base64Data;

      const containerPrefix = currentCameraType === 'preview' ? 'photo' : 'edit-photo';
      const previewContainer = document.getElementById(`${containerPrefix}-preview-container`);
      const previewImg = document.getElementById(`${containerPrefix}-preview`);
      
      if (previewImg) previewImg.src = base64Data;
      if (previewContainer) previewContainer.classList.remove('hidden');

      showToast('Foto berhasil diambil! ðŸ“¸');
      closeCameraModal();
    }

    // ============================================
    // PHOTO UPLOAD HANDLER
    // ============================================

    function handlePhotoUpload(event, type) {
      const file = event.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        showToast('File harus berupa gambar!', 'error');
        return;
      }

      if (file.size > 4 * 1024 * 1024) {
        showToast('Ukuran foto maksimal 4MB', 'error');
        return;
      }

      const reader = new FileReader();
      
      reader.onload = function(e) {
        const base64Data = e.target.result;
        
        if (!base64Data || !base64Data.startsWith('data:image')) {
          showToast('Gagal membaca foto. Coba lagi!', 'error');
          return;
        }
        
        uploadedPhotoData[type] = base64Data;

        const containerPrefix = type === 'preview' ? 'photo' : 'edit-photo';
        const previewContainer = document.getElementById(`${containerPrefix}-preview-container`);
        const previewImg = document.getElementById(`${containerPrefix}-preview`);
        
        if (previewImg) previewImg.src = base64Data;
        if (previewContainer) previewContainer.classList.remove('hidden');
        
        showToast('Foto berhasil diupload! ðŸ“¸');
      };

      reader.onerror = function() {
        showToast('Gagal membaca file. Coba lagi!', 'error');
      };

      reader.readAsDataURL(file);
    }

    function removePhoto(type) {
      uploadedPhotoData[type] = null;
      const containerPrefix = type === 'preview' ? 'photo' : 'edit-photo';
      const previewContainer = document.getElementById(`${containerPrefix}-preview-container`);
      const previewImg = document.getElementById(`${containerPrefix}-preview`);
      
      if (previewImg) {
        previewImg.src = '';
        previewImg.style.display = 'none';
      }
      if (previewContainer) previewContainer.classList.add('hidden');

      if (type === 'preview') {
        const galleryInput = document.getElementById('mom-photo-gallery');
        if (galleryInput) galleryInput.value = '';
      } else {
        const galleryInput = document.getElementById('edit-mom-photo-gallery');
        if (galleryInput) galleryInput.value = '';
      }
    }

    // ============================================
    // DASHBOARD RENDERING
    // ============================================

    function renderDashboard() {
      const openProjects = projects.filter(p => p.status === 'open');
      const closedProjects = projects.filter(p => p.status === 'closed');
      const now = new Date();
      const dueSoon = openProjects.filter(p => {
        if (!p.due_date) return false;
        const dueDate = new Date(p.due_date);
        const diffDays = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
        return diffDays <= 7 && diffDays >= 0;
      });

      const statTotal = document.getElementById('stat-total');
      const statOpen = document.getElementById('stat-open');
      const statClosed = document.getElementById('stat-closed');
      const statDue = document.getElementById('stat-due');

      if (statTotal) statTotal.textContent = projects.length;
      if (statOpen) statOpen.textContent = openProjects.length;
      if (statClosed) statClosed.textContent = closedProjects.length;
      if (statDue) statDue.textContent = dueSoon.length;

      // Render Open Projects
      const openContainer = document.getElementById('open-projects');
      if (!openContainer) return;

      if (openProjects.length === 0) {
        openContainer.innerHTML = '<div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 text-center"><p class="text-slate-400">Tidak ada project open</p></div>';
      } else {
        openContainer.innerHTML = openProjects.map(p => {
          const dueDate = p.due_date ? new Date(p.due_date) : new Date();
          const diffDays = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
          const isDueSoon = diffDays <= 7 && diffDays >= 0;
          const steps = p.steps || [];
          const progress = steps.length > 0 ? Math.round((p.current_step / steps.length) * 100) : 0;

          return `
            <div onclick="openProjectDetail('${p.id}')" class="card-hover bg-white dark:bg-slate-800 rounded-2xl border-2 ${isDueSoon ? 'border-rose-500 shadow-rose-100 dark:shadow-rose-900/20' : 'border-slate-200 dark:border-slate-700'} overflow-hidden cursor-pointer">
              ${isDueSoon ? '<div class="bg-rose-500 text-white text-xs font-semibold px-4 py-1 text-center status-pulse">âš ï¸ Due dalam ' + diffDays + ' hari!</div>' : ''}
              <div class="p-5">
                <div class="flex items-start justify-between mb-3">
                  <h4 class="font-bold text-slate-800 dark:text-white">${p.project_name || 'Unnamed Project'}</h4>
                  <span class="px-2 py-1 text-xs font-medium rounded-lg ${isDueSoon ? 'bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400' : 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400'}">Open</span>
                </div>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-3">PIC: ${p.pic || 'Not specified'}</p>
                <div class="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-4">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  ${p.due_date ? new Date(p.due_date).toLocaleDateString('id-ID') : 'No due date'}
                </div>
                <div class="mb-2">
                  <div class="flex justify-between text-xs mb-1">
                    <span class="text-slate-500 dark:text-slate-400">Progress</span>
                    <span class="font-semibold text-slate-700 dark:text-slate-300">${progress}%</span>
                  </div>
                  <div class="h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-primary-500 to-accent-500 rounded-full transition-all" style="width: ${progress}%"></div>
                  </div>
                </div>
                <p class="text-xs text-slate-400">Step ${p.current_step || 0} dari ${steps.length}</p>
                <p class="text-xs text-primary-500 dark:text-primary-400 mt-2 font-medium">â†’ Klik untuk detail & MoM</p>
              </div>
            </div>
          `;
        }).join('');
      }

      // Render Closed Projects
      const closedContainer = document.getElementById('closed-projects');
      if (!closedContainer) return;

      if (closedProjects.length === 0) {
        closedContainer.innerHTML = '<div class="bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 text-center"><p class="text-slate-400">Tidak ada project closed</p></div>';
      } else {
        closedContainer.innerHTML = closedProjects.map(p => {
          const steps = p.steps || [];
          return `
            <div class="card-hover bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 overflow-hidden opacity-75">
              <div class="p-5">
                <div class="flex items-start justify-between mb-3">
                  <h4 class="font-bold text-slate-800 dark:text-white">${p.project_name || 'Unnamed Project'}</h4>
                  <span class="px-2 py-1 text-xs font-medium rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400">Closed</span>
                </div>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-3">PIC: ${p.pic || 'Not specified'}</p>
                <div class="flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400 mb-4">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  Selesai
                </div>
                <p class="text-xs text-slate-400">${steps.length} steps completed</p>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    // ============================================
    // UPDATE PROJECT PAGE
    // ============================================

    function renderUpdateProjectSelect() {
      const select = document.getElementById('update-project-select');
      if (!select) return;

      const openProjects = projects.filter(p => p.status === 'open');
      select.innerHTML = '<option value="">-- Pilih Project --</option>' + 
        openProjects.map(p => `<option value="${p.id}">${p.project_name}</option>`).join('');
    }

    function loadProjectForUpdate() {
      const select = document.getElementById('update-project-select');
      const infoContainer = document.getElementById('update-project-info');

      if (!select || !infoContainer) return;

      const projectId = select.value;
      if (!projectId) {
        infoContainer.classList.add('hidden');
        selectedProjectForUpdate = null;
        return;
      }

      selectedProjectForUpdate = projects.find(p => p.id === projectId);
      if (!selectedProjectForUpdate) return;

      const updateInfoName = document.getElementById('update-info-name');
      const updateInfoPic = document.getElementById('update-info-pic');
      const updateInfoDue = document.getElementById('update-info-due');

      if (updateInfoName) updateInfoName.textContent = selectedProjectForUpdate.project_name;
      if (updateInfoPic) updateInfoPic.textContent = selectedProjectForUpdate.pic;
      if (updateInfoDue) updateInfoDue.textContent = selectedProjectForUpdate.due_date ? new Date(selectedProjectForUpdate.due_date).toLocaleDateString('id-ID') : 'No due date';

      const steps = selectedProjectForUpdate.steps || [];
      const currentStep = selectedProjectForUpdate.current_step || 0;
      const stepUpdates = selectedProjectForUpdate.step_updates || {};
      const planDates = selectedProjectForUpdate.step_plan_dates || {};
      const actualDates = selectedProjectForUpdate.step_actual_dates || {};

      // Render Timeline
      const timelineContainer = document.getElementById('update-timeline');
      if (timelineContainer) {
        timelineContainer.innerHTML = steps.map((step, index) => {
          const isCompleted = index < currentStep;
          const isCurrent = index === currentStep;
          const planDate = planDates[index] ? new Date(planDates[index]).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }) : '-';
          const actualDate = actualDates[index] ? new Date(actualDates[index]).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }) : '-';
          const progress = stepUpdates[index] || 'Belum dimulai';

          return `
            <div class="flex gap-4">
              <div class="flex flex-col items-center">
                <div class="w-10 h-10 rounded-full flex items-center justify-center ${isCompleted ? 'bg-emerald-500 text-white' : isCurrent ? 'bg-primary-500 text-white' : 'bg-slate-200 dark:bg-slate-700 text-slate-500'}">
                  ${isCompleted ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' : index + 1}
                </div>
                ${index < steps.length - 1 ? '<div class="w-0.5 flex-1 my-2 ' + (isCompleted ? 'bg-emerald-500' : 'bg-slate-200 dark:bg-slate-700') + '"></div>' : ''}
              </div>
              <div class="pb-4 flex-1">
                <p class="font-medium ${isCompleted ? 'text-emerald-600 dark:text-emerald-400' : isCurrent ? 'text-primary-600 dark:text-primary-400' : 'text-slate-600 dark:text-slate-400'}">${step}</p>
                <div class="mt-2 grid grid-cols-2 gap-3 text-xs">
                  <div class="bg-blue-50 dark:bg-blue-900/20 px-3 py-2 rounded-lg">
                    <p class="text-blue-600 dark:text-blue-400 font-medium">Plan</p>
                    <p class="text-slate-700 dark:text-slate-300 mt-1">${planDate}</p>
                  </div>
                  <div class="bg-emerald-50 dark:bg-emerald-900/20 px-3 py-2 rounded-lg">
                    <p class="text-emerald-600 dark:text-emerald-400 font-medium">Actual</p>
                    <p class="text-slate-700 dark:text-slate-300 mt-1">${actualDate}</p>
                  </div>
                </div>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 italic">${progress}</p>
              </div>
            </div>
          `;
        }).join('');
      }

      // Render Step Updates Form
      const updatesContainer = document.getElementById('step-updates-container');
      if (updatesContainer) {
        updatesContainer.innerHTML = steps.map((step, index) => `
          <div class="bg-slate-50 dark:bg-slate-700/50 rounded-xl p-4">
            <p class="text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3">Step ${index + 1}: ${step}</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
              <div>
                <label class="block text-xs text-slate-500 dark:text-slate-400 mb-1">Plan Date</label>
                <input type="date" id="plan-date-${index}" value="${planDates[index] || ''}" class="w-full px-3 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
              </div>
              <div>
                <label class="block text-xs text-slate-500 dark:text-slate-400 mb-1">Actual Date</label>
                <input type="date" id="actual-date-${index}" value="${actualDates[index] || ''}" class="w-full px-3 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
              </div>
              <div>
                <label class="block text-xs text-slate-500 dark:text-slate-400 mb-1">Progress Update</label>
                <input type="text" id="progress-update-${index}" value="${stepUpdates[index] || ''}" placeholder="Status progress..." class="w-full px-3 py-2 text-sm rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
              </div>
            </div>
          </div>
        `).join('');
      }

      // Populate step select
      const stepSelect = document.getElementById('update-step-select');
      if (stepSelect) {
        stepSelect.innerHTML = steps.map((step, index) => 
          `<option value="${index + 1}" ${index + 1 === currentStep ? 'selected' : ''}>Step ${index + 1}: ${step}</option>`
        ).join('') + `<option value="${steps.length + 1}">Selesai (All Steps Completed)</option>`;
      }

      const allStepsCompleted = currentStep >= steps.length;
      const lastStepHasActual = actualDates[steps.length - 1] && actualDates[steps.length - 1] !== '';
      const canClose = allStepsCompleted && lastStepHasActual;

      const statusSelect = document.getElementById('update-status-select');
      if (statusSelect) {
        if (canClose) {
          statusSelect.innerHTML = `
            <option value="open">Open</option>
            <option value="closed">Closed</option>
          `;
          statusSelect.value = selectedProjectForUpdate.status || 'open';
        } else {
          statusSelect.innerHTML = `
            <option value="open">Open</option>
            <option value="closed" disabled>Closed (Selesaikan semua step & isi actual date terakhir)</option>
          `;
          statusSelect.value = 'open';
        }
      }

      infoContainer.classList.remove('hidden');

      if (stepSelect) {
        stepSelect.addEventListener('change', function() {
          updateStatusAvailability();
        });
      }

      steps.forEach((_, index) => {
        const actualInput = document.getElementById(`actual-date-${index}`);
        if (actualInput) {
          actualInput.addEventListener('change', function() {
            updateStatusAvailability();
          });
        }
      });
    }

    function updateStatusAvailability() {
      if (!selectedProjectForUpdate) return;

      const steps = selectedProjectForUpdate.steps || [];
      const stepSelect = document.getElementById('update-step-select');
      const selectedStep = stepSelect ? parseInt(stepSelect.value) : 0;
      
      const lastStepActualInput = document.getElementById(`actual-date-${steps.length - 1}`);
      const lastStepHasActual = lastStepActualInput && lastStepActualInput.value !== '';
      
      const canClose = selectedStep > steps.length && lastStepHasActual;

      const statusSelect = document.getElementById('update-status-select');
      if (!statusSelect) return;
      
      if (canClose) {
        statusSelect.innerHTML = `
          <option value="open">Open</option>
          <option value="closed">Closed</option>
        `;
      } else {
        const currentValue = statusSelect.value;
        statusSelect.innerHTML = `
          <option value="open">Open</option>
          <option value="closed" disabled>Closed (Selesaikan semua step & isi actual date terakhir)</option>
        `;
        statusSelect.value = currentValue === 'closed' ? 'open' : currentValue;
      }
    }

    function updateProject() {
      if (!selectedProjectForUpdate) return;

      const btn = document.getElementById('update-btn');
      const btnText = document.getElementById('update-btn-text');
      const btnLoading = document.getElementById('update-btn-loading');

      if (!btn || !btnText || !btnLoading) return;

      btn.disabled = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');

      try {
        const stepSelect = document.getElementById('update-step-select');
        const statusSelect = document.getElementById('update-status-select');
        
        if (!stepSelect || !statusSelect) throw new Error('Form elements not found');

        const newStep = parseInt(stepSelect.value);
        const newStatus = statusSelect.value;
        const steps = selectedProjectForUpdate.steps || [];

        const stepUpdates = selectedProjectForUpdate.step_updates || {};
        const planDates = selectedProjectForUpdate.step_plan_dates || {};
        const actualDates = selectedProjectForUpdate.step_actual_dates || {};

        steps.forEach((step, index) => {
          const planDateEl = document.getElementById(`plan-date-${index}`);
          const actualDateEl = document.getElementById(`actual-date-${index}`);
          const progressEl = document.getElementById(`progress-update-${index}`);

          if (planDateEl && planDateEl.value) {
            planDates[index] = planDateEl.value;
          }
          if (actualDateEl && actualDateEl.value) {
            actualDates[index] = actualDateEl.value;
          }
          if (progressEl && progressEl.value) {
            stepUpdates[index] = progressEl.value;
          }
        });

        // Update project in memory
        const projectIndex = projects.findIndex(p => p.id === selectedProjectForUpdate.id);
        if (projectIndex !== -1) {
          projects[projectIndex] = {
            ...projects[projectIndex],
            current_step: Math.min(newStep, steps.length),
            status: newStatus,
            step_updates: stepUpdates,
            step_plan_dates: planDates,
            step_actual_dates: actualDates,
            updated_at: new Date().toISOString()
          };

          // Save to localStorage
          saveProjects();

          // Add history
          history.unshift({
            action: 'Update Project',
            details: `Project "${selectedProjectForUpdate.project_name}" diupdate ke Step ${newStep}${newStatus === 'closed' ? ' dan ditutup' : ''}`,
            timestamp: new Date().toISOString()
          });
          saveHistory();

          showToast('Project berhasil diupdate!');
          fetchAllData();
          loadProjectForUpdate();
        }
      } catch (error) {
        console.error('Error updating project:', error);
        showToast('Gagal mengupdate project: ' + error.message, 'error');
      }

      btn.disabled = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
    }

    // ============================================
    // MANAGEMENT PAGE
    // ============================================

    function loginManagement() {
      const password = document.getElementById('management-password');
      const errorEl = document.getElementById('login-error');

      if (!password || !errorEl) return;

      if (password.value === 'admin123') {
        isLoggedIn = true;
        localStorage.setItem('timeline_logged_in', 'true');
        
        const loginEl = document.getElementById('management-login');
        const contentEl = document.getElementById('management-content');
        
        if (loginEl) loginEl.classList.add('hidden');
        if (contentEl) contentEl.classList.remove('hidden');
        
        errorEl.classList.add('hidden');
        fetchAllData();
      } else {
        errorEl.classList.remove('hidden');
      }
    }

    function logoutManagement() {
      isLoggedIn = false;
      localStorage.setItem('timeline_logged_in', 'false');
      
      const password = document.getElementById('management-password');
      const loginEl = document.getElementById('management-login');
      const contentEl = document.getElementById('management-content');
      
      if (password) password.value = '';
      if (loginEl) loginEl.classList.remove('hidden');
      if (contentEl) contentEl.classList.add('hidden');
    }

    function addStep() {
      const container = document.getElementById('steps-container');
      if (!container) return;

      const stepCount = container.children.length + 1;
      const div = document.createElement('div');
      div.className = 'flex gap-2';
      div.innerHTML = `
        <input type="text" class="step-input flex-1 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="Step ${stepCount}">
        <button onclick="this.parentElement.remove()" class="p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-xl transition-all">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      `;
      container.appendChild(div);
    }

    function submitProject() {
      const nameInput = document.getElementById('project-name');
      const picInput = document.getElementById('project-pic');
      const dueInput = document.getElementById('project-due');

      if (!nameInput || !picInput || !dueInput) return;

      const name = nameInput.value.trim();
      const pic = picInput.value.trim();
      const due = dueInput.value;
      const stepInputs = document.querySelectorAll('.step-input');
      const steps = Array.from(stepInputs).map(i => i.value.trim()).filter(s => s);

      if (!name || !pic || !due || steps.length === 0) {
        showToast('Mohon lengkapi semua field', 'error');
        return;
      }

      const btn = document.getElementById('submit-project-btn');
      const btnText = document.getElementById('submit-btn-text');
      const btnLoading = document.getElementById('submit-btn-loading');

      if (!btn || !btnText || !btnLoading) return;

      btn.disabled = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');

      try {
        // Generate unique ID
        const newProject = {
          id: 'project-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
          project_name: name,
          pic: pic,
          due_date: due,
          status: 'open',
          steps: steps,
          current_step: 0,
          step_updates: {},
          step_plan_dates: {},
          step_actual_dates: {},
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        };

        projects.unshift(newProject);
        saveProjects();

        // Add history
        history.unshift({
          action: 'Create Project',
          details: `Project "${name}" ditambahkan dengan ${steps.length} steps`,
          timestamp: new Date().toISOString()
        });
        saveHistory();

        // Reset form
        nameInput.value = '';
        picInput.value = '';
        dueInput.value = '';
        const stepsContainer = document.getElementById('steps-container');
        if (stepsContainer) {
          stepsContainer.innerHTML = `
            <div class="flex gap-2">
              <input type="text" class="step-input flex-1 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="Step 1">
            </div>
          `;
        }
        showToast('Project berhasil ditambahkan!');
        fetchAllData();
      } catch (error) {
        console.error('Error adding project:', error);
        showToast('Gagal menambahkan project: ' + error.message, 'error');
      }

      btn.disabled = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
    }

    // ============================================
    // PROJECT LIST
    // ============================================

    function renderProjectList() {
      const container = document.getElementById('project-list');
      if (!container) return;

      if (projects.length === 0) {
        container.innerHTML = '<p class="text-slate-400 text-center py-4">Tidak ada project</p>';
        return;
      }

      container.innerHTML = projects.map(p => `
        <div class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700/50 rounded-xl">
          <div class="flex-1 min-w-0">
            <p class="font-semibold text-slate-800 dark:text-white truncate">${p.project_name || 'Unnamed Project'}</p>
            <p class="text-sm text-slate-500 dark:text-slate-400">${p.pic || 'No PIC'} â€¢ ${p.due_date ? new Date(p.due_date).toLocaleDateString('id-ID') : 'No due date'}</p>
          </div>
          <div class="flex items-center gap-2 ml-4">
            <span class="px-2 py-1 text-xs font-medium rounded-lg ${p.status === 'open' ? 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400' : 'bg-slate-200 dark:bg-slate-600 text-slate-600 dark:text-slate-300'}">${p.status || 'open'}</span>
            <button onclick="openEditModal('${p.id}')" class="p-2 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-all">
              <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
            </button>
            <button onclick="openDeleteModal('${p.id}')" class="p-2 hover:bg-rose-100 dark:hover:bg-rose-900/20 rounded-lg transition-all">
              <svg class="w-4 h-4 text-rose-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    // ============================================
    // EDIT MODAL
    // ============================================

    function openEditModal(projectId) {
      const project = projects.find(p => p.id === projectId);
      if (!project) return;

      document.getElementById('edit-project-id').value = projectId;
      document.getElementById('edit-project-name').value = project.project_name;
      document.getElementById('edit-project-pic').value = project.pic;
      document.getElementById('edit-project-due').value = project.due_date;

      const steps = project.steps || [];
      const container = document.getElementById('edit-steps-container');
      if (container) {
        container.innerHTML = steps.map((step, index) => `
          <div class="flex gap-2">
            <input type="text" class="edit-step-input flex-1 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="Step ${index + 1}" value="${step}">
            <button onclick="this.parentElement.remove()" class="p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-xl transition-all">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        `).join('');
      }

      const modal = document.getElementById('edit-modal');
      if (modal) modal.classList.remove('hidden');
    }

    function addEditStep() {
      const container = document.getElementById('edit-steps-container');
      if (!container) return;

      const stepCount = container.children.length + 1;
      const div = document.createElement('div');
      div.className = 'flex gap-2';
      div.innerHTML = `
        <input type="text" class="edit-step-input flex-1 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all" placeholder="Step ${stepCount}">
        <button onclick="this.parentElement.remove()" class="p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-xl transition-all">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      `;
      container.appendChild(div);
    }

    function closeEditModal() {
      const modal = document.getElementById('edit-modal');
      if (modal) modal.classList.add('hidden');
    }

    function saveEditProject() {
      const projectId = document.getElementById('edit-project-id');
      if (!projectId) return;

      const project = projects.find(p => p.id === projectId.value);
      if (!project) return;

      const nameInput = document.getElementById('edit-project-name');
      const picInput = document.getElementById('edit-project-pic');
      const dueInput = document.getElementById('edit-project-due');

      if (!nameInput || !picInput || !dueInput) return;

      const name = nameInput.value.trim();
      const pic = picInput.value.trim();
      const due = dueInput.value;
      const stepInputs = document.querySelectorAll('.edit-step-input');
      const steps = Array.from(stepInputs).map(i => i.value.trim()).filter(s => s);

      if (!name || !pic || !due || steps.length === 0) {
        showToast('Mohon lengkapi semua field', 'error');
        return;
      }

      const btn = document.getElementById('save-edit-btn');
      const btnText = document.getElementById('save-edit-btn-text');
      const btnLoading = document.getElementById('save-edit-btn-loading');

      if (!btn || !btnText || !btnLoading) return;

      btn.disabled = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');

      try {
        const projectIndex = projects.findIndex(p => p.id === projectId.value);
        if (projectIndex !== -1) {
          projects[projectIndex] = {
            ...projects[projectIndex],
            project_name: name,
            pic: pic,
            due_date: due,
            steps: steps,
            updated_at: new Date().toISOString()
          };

          saveProjects();

          // Add history
          history.unshift({
            action: 'Edit Project',
            details: `Project "${name}" diedit (${steps.length} steps)`,
            timestamp: new Date().toISOString()
          });
          saveHistory();

          showToast('Project berhasil diupdate!');
          fetchAllData();
          closeEditModal();
        }
      } catch (error) {
        console.error('Error updating project:', error);
        showToast('Gagal mengupdate project: ' + error.message, 'error');
      }

      btn.disabled = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
    }

    // ============================================
    // DELETE MODAL
    // ============================================

    function openDeleteModal(projectId) {
      const project = projects.find(p => p.id === projectId);
      if (!project) return;

      projectToDelete = project;
      document.getElementById('delete-project-id').value = projectId;
      document.getElementById('delete-project-name').textContent = `Apakah Anda yakin ingin menghapus "${project.project_name}"?`;
      document.getElementById('delete-modal').classList.remove('hidden');
    }

    function closeDeleteModal() {
      const modal = document.getElementById('delete-modal');
      if (modal) modal.classList.add('hidden');
      projectToDelete = null;
    }

    function confirmDelete() {
      if (!projectToDelete) return;

      const btn = document.getElementById('confirm-delete-btn');
      const btnText = document.getElementById('confirm-delete-btn-text');
      const btnLoading = document.getElementById('confirm-delete-btn-loading');

      if (!btn || !btnText || !btnLoading) return;

      btn.disabled = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');

      try {
        const projectIndex = projects.findIndex(p => p.id === projectToDelete.id);
        if (projectIndex !== -1) {
          projects.splice(projectIndex, 1);
          saveProjects();

          // Add history
          history.unshift({
            action: 'Delete Project',
            details: `Project "${projectToDelete.project_name}" dihapus`,
            timestamp: new Date().toISOString()
          });
          saveHistory();

          // Delete related MoMs
          moms = moms.filter(m => m.project_id !== projectToDelete.id);
          saveMoms();

          showToast('Project berhasil dihapus!');
          fetchAllData();
          closeDeleteModal();
        }
      } catch (error) {
        console.error('Error deleting project:', error);
        showToast('Gagal menghapus project: ' + error.message, 'error');
      }

      btn.disabled = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
    }

    // ============================================
    // HISTORY PAGE
    // ============================================

    function renderHistoryTable() {
      const tbody = document.getElementById('history-table');
      if (!tbody) return;

      if (history.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="px-6 py-8 text-center text-slate-400">Tidak ada riwayat</td></tr>';
        return;
      }

      tbody.innerHTML = history.map(h => `
        <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-400">${new Date(h.timestamp).toLocaleString('id-ID')}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-3 py-1 text-xs font-medium rounded-full ${h.action.includes('Create') ? 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400' : h.action.includes('Delete') ? 'bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400' : 'bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400'}">${h.action}</span>
          </td>
          <td class="px-6 py-4 text-sm text-slate-800 dark:text-slate-200">${h.details}</td>
        </tr>
      `).join('');
    }

    function renderPDFSelect() {
      const select = document.getElementById('pdf-project-select');
      if (!select) return;

      select.innerHTML = '<option value="">-- Pilih Project untuk PDF --</option>' + 
        projects.map(p => `<option value="${p.id}">${p.project_name}</option>`).join('');
    }

    // ============================================
    // DOWNLOAD PDF
    // ============================================

    async function downloadPDF() {
      const projectId = document.getElementById('pdf-project-select');
      if (!projectId) return;

      if (!projectId.value) {
        showToast('Pilih project terlebih dahulu', 'error');
        return;
      }

      const project = projects.find(p => p.id === projectId.value);
      if (!project) return;

      try {
        // Load jsPDF dynamically
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
        script.onload = function() {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          doc.setFontSize(20);
          doc.setFont('helvetica', 'bold');
          doc.text('Project Report', 105, 20, { align: 'center' });

          doc.setFontSize(12);
          doc.setFont('helvetica', 'normal');
          doc.text(`Nama Project: ${project.project_name}`, 20, 40);
          doc.text(`PIC: ${project.pic}`, 20, 50);
          doc.text(`Due Date: ${project.due_date ? new Date(project.due_date).toLocaleDateString('id-ID') : 'No due date'}`, 20, 60);
          doc.text(`Status: ${project.status ? project.status.toUpperCase() : 'OPEN'}`, 20, 70);

          const steps = project.steps || [];
          doc.setFont('helvetica', 'bold');
          doc.text('Timeline Steps:', 20, 90);
          doc.setFont('helvetica', 'normal');

          steps.forEach((step, index) => {
            const status = index < (project.current_step || 0) ? 'âœ“' : index === (project.current_step || 0) ? 'â—' : 'â—‹';
            doc.text(`${status} Step ${index + 1}: ${step}`, 25, 100 + (index * 10));
          });

          const projectHistory = history.filter(h => h.details.includes(project.project_name));
          if (projectHistory.length > 0) {
            const yPos = 110 + (steps.length * 10);
            doc.setFont('helvetica', 'bold');
            doc.text('Activity Log:', 20, yPos);
            doc.setFont('helvetica', 'normal');

            projectHistory.slice(0, 10).forEach((h, index) => {
              doc.setFontSize(10);
              doc.text(`${new Date(h.timestamp).toLocaleString('id-ID')} - ${h.action}`, 25, yPos + 10 + (index * 8));
            });
          }

          doc.setFontSize(8);
          doc.text(`Generated: ${new Date().toLocaleString('id-ID')}`, 20, 280);

          doc.save(`Project_${project.project_name.replace(/\s+/g, '_')}.pdf`);
          showToast('PDF berhasil didownload!');
        };
        document.head.appendChild(script);
      } catch (error) {
        console.error('Error generating PDF:', error);
        showToast('Gagal membuat PDF: ' + error.message, 'error');
      }
    }

    // ============================================
    // PROJECT DETAIL MODAL FUNCTIONS
    // ============================================

    function openProjectDetail(projectId) {
      const project = projects.find(p => p.id === projectId);
      if (!project) return;

      selectedProjectDetail = project;
      
      const detailName = document.getElementById('detail-project-name');
      const detailInfo = document.getElementById('detail-project-info');
      
      if (detailName) detailName.textContent = project.project_name;
      if (detailInfo) detailInfo.textContent = `PIC: ${project.pic || 'Not specified'} â€¢ Due: ${project.due_date ? new Date(project.due_date).toLocaleDateString('id-ID') : 'No due date'} â€¢ Status: ${(project.status || 'open').toUpperCase()}`;

      const steps = project.steps || [];
      const currentStep = project.current_step || 0;
      const stepUpdates = project.step_updates || {};
      const planDates = project.step_plan_dates || {};
      const actualDates = project.step_actual_dates || {};

      const timelineContainer = document.getElementById('detail-timeline');
      if (timelineContainer) {
        timelineContainer.innerHTML = steps.map((step, index) => {
          const isCompleted = index < currentStep;
          const isCurrent = index === currentStep;
          const planDate = planDates[index] ? new Date(planDates[index]).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }) : '-';
          const actualDate = actualDates[index] ? new Date(actualDates[index]).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }) : '-';
          const progress = stepUpdates[index] || 'Belum dimulai';

          return `
            <div class="flex gap-4">
              <div class="flex flex-col items-center">
                <div class="w-10 h-10 rounded-full flex items-center justify-center ${isCompleted ? 'bg-emerald-500 text-white' : isCurrent ? 'bg-primary-500 text-white' : 'bg-slate-200 dark:bg-slate-700 text-slate-500'}">
                  ${isCompleted ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' : index + 1}
                </div>
                ${index < steps.length - 1 ? '<div class="w-0.5 flex-1 my-2 ' + (isCompleted ? 'bg-emerald-500' : 'bg-slate-200 dark:bg-slate-700') + '"></div>' : ''}
              </div>
              <div class="pb-4 flex-1">
                <p class="font-medium ${isCompleted ? 'text-emerald-600 dark:text-emerald-400' : isCurrent ? 'text-primary-600 dark:text-primary-400' : 'text-slate-600 dark:text-slate-400'}">${step}</p>
                <div class="mt-2 grid grid-cols-2 gap-2 text-xs">
                  <div class="bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded">
                    <p class="text-blue-600 dark:text-blue-400 font-medium">Plan: ${planDate}</p>
                  </div>
                  <div class="bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded">
                    <p class="text-emerald-600 dark:text-emerald-400 font-medium">Actual: ${actualDate}</p>
                  </div>
                </div>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-1 italic">${progress}</p>
              </div>
            </div>
          `;
        }).join('');
      }

      renderMoMList(projectId);

      const modal = document.getElementById('project-detail-modal');
      if (modal) modal.classList.remove('hidden');
    }

    function closeProjectDetail() {
      const modal = document.getElementById('project-detail-modal');
      if (modal) modal.classList.add('hidden');
      selectedProjectDetail = null;
      hideAddMoMForm();
    }

    function renderMoMList(projectId) {
      const projectMoMs = moms.filter(m => m.project_id === projectId);
      const container = document.getElementById('mom-list');

      if (!container) return;

      if (projectMoMs.length === 0) {
        container.innerHTML = '<p class="text-slate-400 text-center py-4 text-sm">Belum ada MoM</p>';
        return;
      }

      container.innerHTML = projectMoMs.map(m => {
        const hasPhoto = m.photo_url && m.photo_url !== '' && m.photo_url !== 'null';
        
        return `
        <div class="bg-white dark:bg-slate-700 rounded-lg p-4 border border-slate-200 dark:border-slate-600">
          <div class="flex items-start justify-between mb-2">
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <span class="font-semibold text-slate-800 dark:text-white text-sm">${new Date(m.mom_date).toLocaleDateString('id-ID', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' })}</span>
            </div>
            <div class="flex gap-1">
              <button onclick="openEditMoMModal('${m.id}')" class="p-1 hover:bg-slate-100 dark:hover:bg-slate-600 rounded transition-all">
                <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
              </button>
              <button onclick="deleteMoM('${m.id}')" class="p-1 hover:bg-rose-100 dark:hover:bg-rose-900/20 rounded transition-all">
                <svg class="w-4 h-4 text-rose-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
              </button>
            </div>
          </div>
          ${hasPhoto ? `
            <div class="mb-3">
              <img loading="lazy" src="${m.photo_url}" alt="Foto meeting" class="w-full h-40 object-cover rounded-lg border border-slate-200 dark:border-slate-600" onerror="this.style.display='none';">
            </div>
          ` : ''}
          <div class="text-xs text-slate-600 dark:text-slate-400 mb-2">
            <strong>Attendees:</strong> ${m.attendees}
          </div>
          <div class="text-sm text-slate-700 dark:text-slate-300 mb-2">
            ${m.discussion}
          </div>
          <div class="text-xs text-slate-600 dark:text-slate-400 bg-slate-50 dark:bg-slate-800/50 rounded p-2">
            <strong>Action Items:</strong><br>
            ${m.action_items ? m.action_items.split('\n').map(item => `<span class="block ml-2">â€¢ ${item}</span>`).join('') : 'No action items'}
          </div>
        </div>
      `;
      }).join('');
    }

    function showAddMoMForm() {
      const form = document.getElementById('add-mom-form');
      const dateInput = document.getElementById('mom-date');
      
      if (form) form.classList.remove('hidden');
      if (dateInput) dateInput.valueAsDate = new Date();
    }

    function hideAddMoMForm() {
      const form = document.getElementById('add-mom-form');
      if (!form) return;

      const dateInput = document.getElementById('mom-date');
      const attendeesInput = document.getElementById('mom-attendees');
      const discussionInput = document.getElementById('mom-discussion');
      const actionsInput = document.getElementById('mom-actions');

      if (dateInput) dateInput.value = '';
      if (attendeesInput) attendeesInput.value = '';
      if (discussionInput) discussionInput.value = '';
      if (actionsInput) actionsInput.value = '';
      
      form.classList.add('hidden');
      removePhoto('preview');
    }

    function submitMoM() {
      if (!selectedProjectDetail) return;

      const dateInput = document.getElementById('mom-date');
      const attendeesInput = document.getElementById('mom-attendees');
      const discussionInput = document.getElementById('mom-discussion');
      const actionsInput = document.getElementById('mom-actions');

      if (!dateInput || !attendeesInput || !discussionInput || !actionsInput) return;

      const date = dateInput.value;
      const attendees = attendeesInput.value.trim();
      const discussion = discussionInput.value.trim();
      const actions = actionsInput.value.trim();

      if (!date || !attendees || !discussion || !actions) {
        showToast('Mohon lengkapi semua field', 'error');
        return;
      }

      const btn = document.getElementById('submit-mom-btn');
      const btnText = document.getElementById('submit-mom-text');
      const btnLoading = document.getElementById('submit-mom-loading');

      if (!btn || !btnText || !btnLoading) return;

      btn.disabled = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');

      try {
        const newMoM = {
          id: 'mom-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
          project_id: selectedProjectDetail.id,
          mom_date: date,
          attendees: attendees,
          discussion: discussion,
          action_items: actions,
          photo_url: uploadedPhotoData.preview,
          created_at: new Date().toISOString()
        };

        moms.unshift(newMoM);
        saveMoms();

        // Add history
        history.unshift({
          action: 'Add MoM',
          details: `MoM ditambahkan untuk project "${selectedProjectDetail.project_name}" (${new Date(date).toLocaleDateString('id-ID')})`,
          timestamp: new Date().toISOString()
        });
        saveHistory();

        showToast('MoM berhasil ditambahkan!');
        fetchAllData();
        hideAddMoMForm();
        renderMoMList(selectedProjectDetail.id);
      } catch (error) {
        console.error('Error adding MoM:', error);
        showToast('Gagal menambahkan MoM: ' + error.message, 'error');
      }

      btn.disabled = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
    }

    function openEditMoMModal(momId) {
      const mom = moms.find(m => m.id === momId);
      if (!mom) return;

      momToEdit = mom;
      document.getElementById('edit-mom-id').value = momId;
      document.getElementById('edit-mom-date').value = mom.mom_date;
      document.getElementById('edit-mom-attendees').value = mom.attendees;
      document.getElementById('edit-mom-discussion').value = mom.discussion;
      document.getElementById('edit-mom-actions').value = mom.action_items;

      // Load photo if exists
      if (mom.photo_url) {
        uploadedPhotoData.edit = mom.photo_url;
        const previewImg = document.getElementById('edit-photo-preview');
        const previewContainer = document.getElementById('edit-photo-preview-container');
        
        if (previewImg) previewImg.src = mom.photo_url;
        if (previewContainer) previewContainer.classList.remove('hidden');
      } else {
        uploadedPhotoData.edit = null;
        const previewImg = document.getElementById('edit-photo-preview');
        const previewContainer = document.getElementById('edit-photo-preview-container');
        
        if (previewImg) previewImg.src = '';
        if (previewContainer) previewContainer.classList.add('hidden');
      }

      const modal = document.getElementById('edit-mom-modal');
      if (modal) modal.classList.remove('hidden');
    }

    function closeEditMoMModal() {
      const modal = document.getElementById('edit-mom-modal');
      if (modal) modal.classList.add('hidden');
      momToEdit = null;
      removePhoto('edit');
    }

    function saveEditMoM() {
      if (!momToEdit) return;

      const dateInput = document.getElementById('edit-mom-date');
      const attendeesInput = document.getElementById('edit-mom-attendees');
      const discussionInput = document.getElementById('edit-mom-discussion');
      const actionsInput = document.getElementById('edit-mom-actions');

      if (!dateInput || !attendeesInput || !discussionInput || !actionsInput) return;

      const date = dateInput.value;
      const attendees = attendeesInput.value.trim();
      const discussion = discussionInput.value.trim();
      const actions = actionsInput.value.trim();

      if (!date || !attendees || !discussion || !actions) {
        showToast('Mohon lengkapi semua field', 'error');
        return;
      }

      const btn = document.getElementById('save-edit-mom-btn');
      const btnText = document.getElementById('save-edit-mom-text');
      const btnLoading = document.getElementById('save-edit-mom-loading');

      if (!btn || !btnText || !btnLoading) return;

      btn.disabled = true;
      btnText.classList.add('hidden');
      btnLoading.classList.remove('hidden');

      try {
        const momIndex = moms.findIndex(m => m.id === momToEdit.id);
        if (momIndex !== -1) {
          moms[momIndex] = {
            ...moms[momIndex],
            mom_date: date,
            attendees: attendees,
            discussion: discussion,
            action_items: actions,
            photo_url: uploadedPhotoData.edit || momToEdit.photo_url,
            updated_at: new Date().toISOString()
          };

          saveMoms();

          // Add history
          history.unshift({
            action: 'Edit MoM',
            details: `MoM diedit untuk project "${selectedProjectDetail ? selectedProjectDetail.project_name : 'Unknown'}" (${new Date(date).toLocaleDateString('id-ID')})`,
            timestamp: new Date().toISOString()
          });
          saveHistory();

          showToast('MoM berhasil diupdate!');
          fetchAllData();
          closeEditMoMModal();
          if (selectedProjectDetail) {
            renderMoMList(selectedProjectDetail.id);
          }
        }
      } catch (error) {
        console.error('Error updating MoM:', error);
        showToast('Gagal mengupdate MoM: ' + error.message, 'error');
      }

      btn.disabled = false;
      btnText.classList.remove('hidden');
      btnLoading.classList.add('hidden');
    }

    function deleteMoM(momId) {
      if (!confirm('Apakah Anda yakin ingin menghapus MoM ini?')) return;

      const mom = moms.find(m => m.id === momId);
      if (!mom) return;

      try {
        const momIndex = moms.findIndex(m => m.id === momId);
        if (momIndex !== -1) {
          moms.splice(momIndex, 1);
          saveMoms();

          // Add history
          history.unshift({
            action: 'Delete MoM',
            details: `MoM dihapus untuk project "${selectedProjectDetail ? selectedProjectDetail.project_name : 'Unknown'}" (${new Date(mom.mom_date).toLocaleDateString('id-ID')})`,
            timestamp: new Date().toISOString()
          });
          saveHistory();

          showToast('MoM berhasil dihapus!');
          fetchAllData();
          if (selectedProjectDetail) {
            renderMoMList(selectedProjectDetail.id);
          }
        }
      } catch (error) {
        console.error('Error deleting MoM:', error);
        showToast('Gagal menghapus MoM: ' + error.message, 'error');
      }
    }

    // ============================================
    // INITIALIZATION
    // ============================================

    // Initialize app when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
